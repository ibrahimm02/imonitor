{% extends "aws/aws_base.html" %} {% block nav_s3 %}active{% endblock %} {%
block title %}iMonitor - S3{% endblock %} {% block navTitle %}S3{% endblock %}
{% block content %}

<!-- <h1>Simple Storage Service (S3)</h1> -->
<!-- <ul>
{% for bucket in response['Buckets'] %}
    <li>{{ bucket.CreationDate }}1</li>
    <li>{{ bucket.Name}}2</li>
    
{% endfor %} 
</ul> -->
<!-- {{ response }} -->
<div class="row">
  <div class="col-sm">
    <div class="card text-center border-0 shadow-sm mb-4 h-80">
      <div class="card-body">
        <h5 class="card-title">Total Buckets</h5>
        <h1 class="display-6">{{response['Buckets']|length}}</h1>
      </div>
    </div>
  </div>
  <div class="col-sm">
    <div class="card text-center border-0 shadow-sm mb-4 h-80">
      <div class="card-body">
        <h5 class="card-title">Total Object Count</h5>
        <h1 class="display-6">
          {% for item in size_count:%} {{item['total_object']}} {% endfor %}
        </h1>
      </div>
    </div>
  </div>
  <div class="col-sm">
    <div class="card text-center border-0 shadow-sm mb-4 h-80">
      <div class="card-body">
        <h5 class="card-title">Total Storage Size</h5>
        <h1 class="display-6">
          {% for item in size_count:%} {{item['total_size']}} {% endfor %}
        </h1>
      </div>
    </div>
  </div>
</div>

<div class="card text-center border-0 shadow-sm mb-4">
  <div class="card-body p-0">
    <div class="table-responsive table-wrapper">
      <table
        class="table table-nowrap mb-0 rounded table-hover"
        style="vertical-align: middle">
        <thead class="table-dark">
          <th class="border-0 rounded-start">Bucket Name</th>
          <!-- <th class="border-0">No of Objects</th>
          <th class="border-0">Storage Bytes</th> -->
          <th class="border-0 rounded-end">Creation Date</th>
        </thead>

        {%for bucket in response['Buckets']%}
        <tr>
          <td>
            <form action="{{ url_for('s3_bucket_data')}}" method="POST">
              <input
                type="hidden"
                name="bucketName"
                value="{{ bucket.Name }}"
              />
              <button
                type="submit"
                class="btn btn-link"
                style="color: #0dcaf0"
              >
                {{bucket.Name}}
              </button>
            </form>          
          </td>
          <!-- <td>{{dp_avg_NOO | last}}</td>
          <td>{{dp_avg_BSB | last}}</td> -->
          <td>{{bucket.CreationDate.strftime("%d-%m-%Y, %H:%M:%S")}}</td>
        </tr>
        {%endfor%}
      </table>
    </div>
  </div>
</div>

<div class="col-sm-6">
  <div class="card border-1 shadow-sm mb-2 px-1">
    <div class="card-body">
      <div class="chart-area p-1">
        <canvas id="bsb-chart"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
  
    // Storage bytes graph
    let dp_t_BSB = JSON.parse({{ dp_time_BSB | tojson }})
    let dp_a_BSB = JSON.parse({{ dp_avg_BSB | tojson}})

    //------------------------------------------------------------

    ec2_ins_graph(dp_t_BSB, dp_a_BSB, "Storage Bytes", "bsb-chart")
    //------------------------------------------------------------
  
    function ec2_ins_graph(dt, da, label, id) {
  
      // Set new default font family and font color
      (Chart.defaults.global.defaultFontFamily = "Nunito"),
      '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
      Chart.defaults.global.defaultFontColor = "#858796";
  
      var chartData = {
        labels: dt,
        datasets: [{
          label: label,
          lineTension: 0.1,
          backgroundColor: "rgba(78, 115, 223, 0.05)",
          borderColor: "rgba(78, 115, 223, 1)",
          pointRadius: 2,
          pointBackgroundColor: "rgba(78, 115, 223, 1)",
          pointBorderColor: "rgba(78, 115, 223, 1)",
          pointHoverRadius: 3,
          pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
          pointHoverBorderColor: "rgba(78, 115, 223, 1)",
          pointHitRadius: 10,
          pointBorderWidth: 2,
  
          data: da,
  
        }],
        options: {
          maintainAspectRatio: false,
          layout: {
            padding: {
              left: 10,
              right: 25,
              top: 25,
              bottom: 0,
            },
          },
          legend: {
            display: false,
          },
          tooltips: {
            backgroundColor: "rgb(255,255,255)",
            bodyFontColor: "#858796",
            titleMarginBottom: 10,
            titleFontColor: "#6e707e",
            titleFontSize: 14,
            borderColor: "#dddfeb",
            borderWidth: 1,
            xPadding: 15,
            yPadding: 15,
            displayColors: false,
            intersect: false,
            mode: "index",
            caretPadding: 10,
          },
        },
      };
  
      var ctx = document.getElementById(id).getContext("2d");
  
      var myChart = new Chart(ctx, {
        type: "line",
        data: chartData,
  
      });
  
    }



</script>

{% endblock content %}
